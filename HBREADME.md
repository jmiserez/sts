Running the current version of the tool.

### Installation

```
$ git clone git://github.com/jmiserez/sts.git
$ cd sts
$ git submodule update --init --recursive
$ ./tools/install_hassel_python.sh
```

This should checkout the hassel and pox repos, and install hassel

### Getting a trace

See the files config/demo_*.py for a description on how to get a trace for each scenario. The hb.json file will be written to the results_dir, among several other files generated by STS. This is the trace file containing the events relevant for the analyzer. The file simulator.out should contain the console output from the session.

Most of the code for this is in the file sts/happensbefore/hb_logger.py. The code there takes in all relevant internal STS events and keeps track of all the current state. These small low level STS all contribute pieces of information, and at certain points a event (as defined for the HB relation) is written out/serialized to JSON and Base64 encoded packets and messages. The whole hb_logger.py code is very fragile and highly dependent on the STS implementation.

Note: After some further thinking in the last few weeks, I think it is possible to define the HB rules on more lower level events directly. However the software switch implementation does a few things wrong (w.r.t the OpenFlow spec) which is why it is not immediadetely clear when working with the code.

### Running the analyzer (offline)

The analyzer lives in the sts/happensbefore/hb_graph.py file, and is completely independent from STS (but not from POX). It parses the hb.json file and produces i) console output and ii) a hb.dot file containing the graph with annotations for races. Run the analyzer from he STS root directory as follows:

```
./sts/happensbefore/hb_graph.py experiments/<results_dir>/hb.json
```
This will output all the races and update the hb.dot graph file. You can open the .dot file with the xdot tool (apt-get install graphviz).

Note that you can run the analyzer at any time, but it can produce wrong results if the information from the controller instrumentation was not yet merged into the hb.json file by the hb_logger. So it's best to run it when there are no outstanding controller HB events that are not yet in the hb.json file.

### Analyzer flags/debug toggles

The analyzer doesn't really have parameters yet, so you need to toggle flags in the code:

```
hb_graph:84 (use_comm_spec) - if True then use tye spec, oherwise simulate using the complete state 
hb_graph:425 (filter_rw) - if True then filter out rw races with no common ancestor
hb_graph:792 (online_update) - if True then rerun algorithms for each new event while STS runs. Note that the results are not always correct due to controller events that have not yet been registered
```

